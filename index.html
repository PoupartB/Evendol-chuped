<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EVENDOL — Évaluation primaire + après antalgie</title>
  <style>
    :root{
      --bg:#0b0c10; --card:#151823; --muted:#9aa4b2; --txt:#eef2ff;
      --line:#2a2f3d; --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444;
      --btn:#232a3a;
    }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--txt); }
    .wrap{ max-width:980px; margin:0 auto; padding:16px; }
    h1{ font-size:20px; margin:0 0 6px; }
    p.small{ margin:0 0 14px; color:var(--muted); font-size:13px; line-height:1.35; }
    .grid{ display:grid; gap:12px; grid-template-columns:1fr; }
    @media (min-width:900px){ .grid{ grid-template-columns:1fr 1fr; } }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px; }
    .row{ display:grid; gap:10px; grid-template-columns:1fr; }
    @media (min-width:640px){ .row{ grid-template-columns:1fr 1fr; } }
    label{ font-size:13px; color:var(--muted); display:block; margin-bottom:6px; }
    input[type="text"], input[type="datetime-local"]{
      width:100%; padding:10px 10px; border-radius:10px; border:1px solid var(--line);
      background:#0f1220; color:var(--txt);
    }
    textarea{
      width:100%; min-height:70px; padding:10px; border-radius:10px; border:1px solid var(--line);
      background:#0f1220; color:var(--txt); resize:vertical;
    }
    .sectionTitle{ display:flex; align-items:baseline; justify-content:space-between; gap:10px; margin-bottom:10px; }
    .sectionTitle h2{ font-size:16px; margin:0; }
    .pill{ font-size:12px; color:var(--muted); border:1px solid var(--line); padding:6px 10px; border-radius:999px; }
    .items{ display:grid; gap:10px; }
    .item{ border:1px solid var(--line); border-radius:12px; padding:10px; background:#0f1220; }
    .item h3{ font-size:14px; margin:0 0 6px; }
    .item p{ margin:0 0 8px; color:var(--muted); font-size:12px; line-height:1.35; }
    .choices{ display:grid; gap:8px; grid-template-columns:repeat(4,minmax(0,1fr)); }
    .choice{
      display:flex; gap:8px; align-items:center; justify-content:center;
      border:1px solid var(--line); border-radius:10px; padding:8px 6px; background:var(--btn);
      font-size:12px; text-align:center; cursor:pointer; user-select:none;
    }
    .choice input{ margin:0; }
    .metaLine{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .badge{ padding:8px 10px; border-radius:12px; border:1px solid var(--line); background:#0f1220; font-size:13px; }
    .score{ font-weight:700; }
    .status{ font-weight:700; }
    .status.ok{ color:var(--ok); }
    .status.warn{ color:var(--warn); }
    .status.bad{ color:var(--bad); }
    .btnRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    button{
      border:1px solid var(--line); background:var(--btn); color:var(--txt);
      padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:600;
    }
    button:hover{ filter:brightness(1.08); }
    .foot{ margin-top:14px; color:var(--muted); font-size:12px; line-height:1.35; }
    .toggle{ display:flex; gap:10px; flex-wrap:wrap; }
    .toggle label{ margin:0; }
    .toggle .opt{
      display:flex; align-items:center; gap:8px; border:1px solid var(--line);
      padding:8px 10px; border-radius:999px; background:#0f1220; cursor:pointer;
      color:var(--txt); font-size:13px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>EVENDOL — Évaluation primaire + après antalgie</h1>
    <p class="small">
      Échelle validée de la naissance à 7 ans • Score total 0–15 • Seuil de traitement : 4/15.
      (Version “une page” basée sur le PDF EVENDOL : uniquement évaluation primaire + après antalgie.) :contentReference[oaicite:2]{index=2}
    </p>

    <div class="card">
      <div class="row">
        <div>
          <label for="nom">Nom</label>
          <input id="nom" type="text" placeholder="Nom / Prénom" />
        </div>
        <div>
          <label for="dt">Date et heure</label>
          <input id="dt" type="datetime-local" />
        </div>
        <div>
          <label for="eval">Initiales évaluateur</label>
          <input id="eval" type="text" placeholder="Ex : BD" />
        </div>
        <div>
          <label for="antalgique">Antalgique (optionnel)</label>
          <input id="antalgique" type="text" placeholder="Ex : paracétamol PO 15 mg/kg à 10h05" />
        </div>
      </div>
    </div>

    <div class="grid" style="margin-top:12px;">
      <!-- PRIMAIRE -->
      <section class="card" id="primaryCard">
        <div class="sectionTitle">
          <h2>Évaluation primaire</h2>
          <span class="pill">Score : <span class="score" id="primaryScore">0</span> / 15</span>
        </div>

        <div class="toggle" aria-label="Situation primaire">
          <div class="opt">
            <input type="radio" id="pR" name="primary_context" value="R" checked>
            <label for="pR">Au repos / au calme (R)</label>
          </div>
          <div class="opt">
            <input type="radio" id="pM" name="primary_context" value="M">
            <label for="pM">À l’examen / mobilisation (M)</label>
          </div>
        </div>

        <div class="items" style="margin-top:10px;">
          <div class="item">
            <h3>Expression vocale ou verbale</h3>
            <p>pleure et/ou crie et/ou gémit et/ou dit qu’il a mal</p>
            <div class="choices" data-group="p_item1">
              ${[0,1,2,3].map(n=>`<label class="choice"><input type="radio" name="p_item1" value="${n}"> ${n}</label>`).join('')}
            </div>
          </div>

          <div class="item">
            <h3>Mimique</h3>
            <p>a le front plissé et/ou les sourcils froncés et/ou la bouche crispée</p>
            <div class="choices" data-group="p_item2">
              ${[0,1,2,3].map(n=>`<label class="choice"><input type="radio" name="p_item2" value="${n}"> ${n}</label>`).join('')}
            </div>
          </div>

          <div class="item">
            <h3>Mouvements</h3>
            <p>s’agite et/ou se raidit et/ou se crispe</p>
            <div class="choices" data-group="p_item3">
              ${[0,1,2,3].map(n=>`<label class="choice"><input type="radio" name="p_item3" value="${n}"> ${n}</label>`).join('')}
            </div>
          </div>

          <div class="item">
            <h3>Positions</h3>
            <p>a une attitude inhabituelle et/ou antalgique et/ou se protège et/ou reste immobile</p>
            <div class="choices" data-group="p_item4">
              ${[0,1,2,3].map(n=>`<label class="choice"><input type="radio" name="p_item4" value="${n}"> ${n}</label>`).join('')}
            </div>
          </div>

          <div class="item">
            <h3>Relation avec l’environnement</h3>
            <p>peut être consolé et/ou s’intéresse aux jeux et/ou communique avec l’entourage</p>
            <div class="choices" data-group="p_item5">
              <label class="choice"><input type="radio" name="p_item5" value="0"> normale (0)</label>
              <label class="choice"><input type="radio" name="p_item5" value="1"> diminuée (1)</label>
              <label class="choice"><input type="radio" name="p_item5" value="2"> très diminuée (2)</label>
              <label class="choice"><input type="radio" name="p_item5" value="3"> absente (3)</label>
            </div>
          </div>
        </div>

        <div class="metaLine">
          <div class="badge">Statut : <span class="status" id="primaryStatus">—</span></div>
        </div>
      </section>

      <!-- APRES ANTALGIE -->
      <section class="card" id="postCard">
        <div class="sectionTitle">
          <h2>Après antalgie</h2>
          <span class="pill">Score : <span class="score" id="postScore">0</span> / 15</span>
        </div>

        <div class="toggle" aria-label="Situation après antalgie">
          <div class="opt">
            <input type="radio" id="aR" name="post_context" value="R" checked>
            <label for="aR">Au repos / au calme (R)</label>
          </div>
          <div class="opt">
            <input type="radio" id="aM" name="post_context" value="M">
            <label for="aM">À l’examen / mobilisation (M)</label>
          </div>
        </div>

        <div class="items" style="margin-top:10px;">
          <div class="item">
            <h3>Expression vocale ou verbale</h3>
            <p>pleure et/ou crie et/ou gémit et/ou dit qu’il a mal</p>
            <div class="choices" data-group="a_item1">
              ${[0,1,2,3].map(n=>`<label class="choice"><input type="radio" name="a_item1" value="${n}"> ${n}</label>`).join('')}
            </div>
          </div>

          <div class="item">
            <h3>Mimique</h3>
            <p>a le front plissé et/ou les sourcils froncés et/ou la bouche crispée</p>
            <div class="choices" data-group="a_item2">
              ${[0,1,2,3].map(n=>`<label class="choice"><input type="radio" name="a_item2" value="${n}"> ${n}</label>`).join('')}
            </div>
          </div>

          <div class="item">
            <h3>Mouvements</h3>
            <p>s’agite et/ou se raidit et/ou se crispe</p>
            <div class="choices" data-group="a_item3">
              ${[0,1,2,3].map(n=>`<label class="choice"><input type="radio" name="a_item3" value="${n}"> ${n}</label>`).join('')}
            </div>
          </div>

          <div class="item">
            <h3>Positions</h3>
            <p>a une attitude inhabituelle et/ou antalgique et/ou se protège et/ou reste immobile</p>
            <div class="choices" data-group="a_item4">
              ${[0,1,2,3].map(n=>`<label class="choice"><input type="radio" name="a_item4" value="${n}"> ${n}</label>`).join('')}
            </div>
          </div>

          <div class="item">
            <h3>Relation avec l’environnement</h3>
            <p>peut être consolé et/ou s’intéresse aux jeux et/ou communique avec l’entourage</p>
            <div class="choices" data-group="a_item5">
              <label class="choice"><input type="radio" name="a_item5" value="0"> normale (0)</label>
              <label class="choice"><input type="radio" name="a_item5" value="1"> diminuée (1)</label>
              <label class="choice"><input type="radio" name="a_item5" value="2"> très diminuée (2)</label>
              <label class="choice"><input type="radio" name="a_item5" value="3"> absente (3)</label>
            </div>
          </div>
        </div>

        <div class="metaLine">
          <div class="badge">Statut : <span class="status" id="postStatus">—</span></div>
        </div>
      </section>
    </div>

    <div class="card" style="margin-top:12px;">
      <label for="remarks">Remarques (optionnel)</label>
      <textarea id="remarks" placeholder="Observation libre…"></textarea>

      <div class="btnRow">
        <button id="resetBtn" type="button">Réinitialiser</button>
        <button id="copyBtn" type="button">Copier le résumé</button>
      </div>

      <div class="foot">
        Rappel (PDF) : observer “au repos / au calme (R)” avant tout soin, et “à l’examen / mobilisation (M)” lors de la mobilisation/palpation. Réévaluer après antalgique au pic d’action. :contentReference[oaicite:3]{index=3}
      </div>
    </div>

  </div>

  <script>
    // --- Helper: inject radio HTML that was templated above (works because file is a single HTML)
    // If you're opening this file and see ${...} text instead of radios: it's because you edited it in a way
    // that removed template literals. This version uses a fallback injector:
    (function ensureChoices(){
      document.querySelectorAll('.choices[data-group]').forEach(box=>{
        if (box.querySelector('input')) return; // already has radios (e.g. relation env has custom labels)
        const name = box.getAttribute('data-group');
        const frag = document.createDocumentFragment();
        [0,1,2,3].forEach(n=>{
          const lab = document.createElement('label');
          lab.className = 'choice';
          const inp = document.createElement('input');
          inp.type = 'radio';
          inp.name = name;
          inp.value = String(n);
          lab.appendChild(inp);
          lab.appendChild(document.createTextNode(' ' + n));
          frag.appendChild(lab);
        });
        box.appendChild(frag);
      });
    })();

    const THRESHOLD = 4;

    function getGroupValue(name){
      const el = document.querySelector('input[name="'+name+'"]:checked');
      return el ? parseInt(el.value, 10) : 0;
    }

    function calc(prefix){
      const total =
        getGroupValue(prefix+'_item1') +
        getGroupValue(prefix+'_item2') +
        getGroupValue(prefix+'_item3') +
        getGroupValue(prefix+'_item4') +
        getGroupValue(prefix+'_item5');
      return total;
    }

    function statusText(score){
      if (score === 0) return {txt:"—", cls:""};
      if (score < THRESHOLD) return {txt:"< 4/15 (pas de seuil)", cls:"ok"};
      // score >= 4
      return {txt:"≥ 4/15 (seuil de traitement)", cls:"bad"};
    }

    function update(){
      const p = calc('p');
      const a = calc('a');

      const ps = document.getElementById('primaryScore');
      const as = document.getElementById('postScore');
      ps.textContent = p;
      as.textContent = a;

      const pst = document.getElementById('primaryStatus');
      const ast = document.getElementById('postStatus');

      const pObj = statusText(p);
      const aObj = statusText(a);

      pst.textContent = pObj.txt;
      pst.className = "status " + pObj.cls;

      ast.textContent = aObj.txt;
      ast.className = "status " + aObj.cls;
    }

    document.addEventListener('change', (e)=> {
      if (e.target.matches('input[type="radio"]')) update();
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      document.querySelectorAll('input[type="radio"]').forEach(r=> r.checked = false);
      // remettre R par défaut
      document.getElementById('pR').checked = true;
      document.getElementById('aR').checked = true;

      document.getElementById('nom').value = '';
      document.getElementById('eval').value = '';
      document.getElementById('antalgique').value = '';
      document.getElementById('remarks').value = '';

      // set date/time to now (local)
      const dt = document.getElementById('dt');
      const now = new Date();
      const pad = (n)=> String(n).padStart(2,'0');
      dt.value = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;

      update();
    });

    document.getElementById('copyBtn').addEventListener('click', async ()=>{
      const nom = document.getElementById('nom').value.trim();
      const dt = document.getElementById('dt').value;
      const evalInit = document.getElementById('eval').value.trim();
      const ant = document.getElementById('antalgique').value.trim();
      const rem = document.getElementById('remarks').value.trim();

      const pCtx = document.querySelector('input[name="primary_context"]:checked')?.value || 'R';
      const aCtx = document.querySelector('input[name="post_context"]:checked')?.value || 'R';

      const p = calc('p');
      const a = calc('a');

      const lines = [
        "EVENDOL (0–15) — seuil 4/15",
        nom ? `Nom : ${nom}` : null,
        dt ? `Date/heure : ${dt}` : null,
        evalInit ? `Évaluateur : ${evalInit}` : null,
        ant ? `Antalgique : ${ant}` : null,
        `Évaluation primaire (${pCtx}) : ${p}/15`,
        `Après antalgie (${aCtx}) : ${a}/15`,
        rem ? `Remarques : ${rem}` : null
      ].filter(Boolean);

      try{
        await navigator.clipboard.writeText(lines.join("\n"));
        alert("Résumé copié dans le presse-papiers.");
      }catch(err){
        prompt("Copie manuelle (Ctrl+C) :", lines.join("\n"));
      }
    });

    // init date/time + first update
    (function init(){
      const dt = document.getElementById('dt');
      const now = new Date();
      const pad = (n)=> String(n).padStart(2,'0');
      dt.value = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
      update();
    })();
  </script>
</body>
</html>
